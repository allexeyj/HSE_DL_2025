# üßä HSE DL 2025: Stage 1 - Image-to-3D Alignment

**–í–µ—Ç–∫–∞:** `project_training_stage_1`

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—É—á–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–µ–∂–¥—É 2D –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ 3D –æ–±–ª–∞–∫–∞–º–∏ —Ç–æ—á–µ–∫. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –≤—ã—É—á–∏—Ç—å –æ–±—â–µ–µ —ç–º–±–µ–¥–¥–∏–Ω–≥-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –≥–¥–µ –ø—Ä–æ–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –∏ –µ–≥–æ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (–æ–±–ª–∞–∫–æ —Ç–æ—á–µ–∫) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –±–ª–∏–∑–∫–æ.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

*   **3D Encoder:** ReConV2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–ª–∞–∫–æ–≤ —Ç–æ—á–µ–∫.
*   **Image Encoder:** Pre-trained ViT (EVA-02 Large), –≤–µ—Å–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã.
*   **Projection Head:** Mixture of Experts ‚Äî –æ–±—É—á–∞–µ–º–∞—è –≥–æ–ª–æ–≤–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –æ–±—â–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ.
*   **Loss:** `MultiPositiveContrastiveLoss`. –£—á–∏—Ç—ã–≤–∞–µ—Ç, —á—Ç–æ —É –æ–¥–Ω–æ–≥–æ 3D –æ–±—ä–µ–∫—Ç–∞ –µ—Å—Ç—å 24 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∏–¥–∞ (images), —Å—á–∏—Ç–∞—è –∏—Ö –≤—Å–µ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

*   `cad_retrieval_utils/` ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏, –º–æ–¥–µ–ª—è–º–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏.
*   `ReConV2/` ‚Äî –ü–æ–¥–º–æ–¥—É–ª—å —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π 3D —ç–Ω–∫–æ–¥–µ—Ä–∞.
*   `extract_train_embeddings.py` ‚Äî –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è).
*   `train.py` / `trainer.py` ‚Äî –¶–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è.
*   `inference_runner.py` ‚Äî –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∞–±–º–∏—Ç–∞.

## üöÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ `requirements.txt`.
–î–ª—è —Ä–∞–±–æ—Ç—ã 3D –æ–ø–µ—Ä–∞—Ü–∏–π (Chamfer Distance) –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è CUDA —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ `ReConV2`.

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
–î–ª—è –æ–±—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —á—Ç–æ–±—ã –Ω–µ –¥–µ—Ä–∂–∞—Ç—å —Ç—è–∂–µ–ª—ã–π Image Encoder –≤ –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–¥–ª—è –º–æ–¥–µ–ª–µ–π –±–µ–∑ —Ç–µ–∫—Å—Ç–∞, ID 525+):
```bash
python extract_train_embeddings.py
```
*–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç `.npz` —Ñ–∞–π–ª, –ø—É—Ç—å –∫ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ.*

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `cad_retrieval_utils/configs/config.py`.

### 4. –û–±—É—á–µ–Ω–∏–µ
–ó–∞–ø—É—Å–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:
```bash
python -m cad_retrieval_utils.train --config cad_retrieval_utils/configs/config.py
```

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —á–µ–∫–ø–æ–∏–Ω—Ç—ã –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª—É—á—à–µ–≥–æ Recall@3.
–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–≤–∞ —Ñ–∞–π–ª–∞:
1.  `moe_recall@K_*.pth` ‚Äî –≤–µ—Å–∞ –ø—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω–æ–π –≥–æ–ª–æ–≤—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
2.  `pc_encoder_recall@K_*.pth` ‚Äî –≤–µ—Å–∞ 3D —ç–Ω–∫–æ–¥–µ—Ä–∞ (ReCon).

### 5. –ò–Ω—Ñ–µ—Ä–µ–Ω—Å
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `submission.csv` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–Ω—Å–∞–º–±–ª—å –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –æ–¥–∏–Ω–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å. –°–∫—Ä–∏–ø—Ç —Ä–µ—à–∞–µ—Ç –¥–≤–µ –∑–∞–¥–∞—á–∏: `Image -> Mesh` –∏ `Mesh -> Image`.

```bash
python -m cad_retrieval_utils.inference_runner \
    --config cad_retrieval_utils/configs/config.py \
    --model path/to/moe.pth:path/to/pc_encoder.pth \
    --output submission_stage1.csv
```

**–§–æ—Ä–º–∞—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `--model`:** `–ø—É—Ç—å_–∫_moe:–ø—É—Ç—å_–∫_pc_encoder`
–í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ–ª–∞–≥ `--model` –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –∞–Ω—Å–∞–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (—É—Å—Ä–µ–¥–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤).

---
**–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ `pc_encoder_recall@*.pth` –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ **–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–π** –±—ç–∫–±–æ–Ω –¥–ª—è Stage 2.
